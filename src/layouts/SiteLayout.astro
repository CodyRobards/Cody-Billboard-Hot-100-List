---
import "../styles/critical.css";
import navigationScriptHref from "../scripts/prefetch-navigation.ts?url";
import serviceWorkerScriptHref from "../scripts/register-service-worker.ts?url";
import spotifyToggleScriptHref from "../scripts/spotify-embed-toggle.ts?url";
import scrollControlsScriptHref from "../scripts/scroll-controls.ts?url";
import nonCriticalStylesHref from "../styles/noncritical.css?url";
import SiteNavigation from "../components/SiteNavigation.astro";
import { getYearGroups } from "../lib/content-utils";

interface Props {
  pageTitle?: string;
  description?: string;
}

const { pageTitle, description } = Astro.props as Props;
const siteTitle = "Cody's Billboard Hot 100 #1 Hits";
const documentTitle = pageTitle ? `${pageTitle} | ${siteTitle}` : siteTitle;
const metaDescription =
  description ??
  "An instant-reference archive of Billboard Hot 100 milestones with year-by-year recaps and chart rankings.";

const years = await getYearGroups();

const currentPath = Astro.url.pathname.endsWith("/")
  ? Astro.url.pathname
  : `${Astro.url.pathname}/`;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={metaDescription} />
    <title>{documentTitle}</title>
    <link rel="preload" as="style" href={nonCriticalStylesHref} onload="this.rel='stylesheet'" />
    <noscript>
      <link rel="stylesheet" href={nonCriticalStylesHref} />
    </noscript>
  </head>
  <body>
    <a class="skip-link" href="#page-main">Skip to main content</a>
    <div class="page-frame">
      <header class="site-header" aria-label="Site introduction">
        <p class="site-header__kicker">{siteTitle}</p>
        <p class="site-header__tagline">
          Liner-note storytelling, instant navigation, and performant delivery inspired by
          McMaster-Carr's catalog experience.
        </p>
        <form class="site-header__search" action="/search/" method="get" role="search">
          <label class="visually-hidden" for="site-header-search">Search #1 hits</label>
          <div class="site-header__search-field">
            <input
              id="site-header-search"
              class="site-header__search-input"
              type="search"
              name="q"
              inputmode="search"
              placeholder="Search songs, artists, or years"
              autocomplete="off"
            />
            <span class="site-header__search-icon" aria-hidden="true">üîç</span>
          </div>
        </form>
      </header>
      <div class="page-layout" id="content-root">
        <aside class="page-layout__nav" aria-label="Primary navigation">
          <SiteNavigation years={years} currentPath={currentPath} />
        </aside>
        <main id="page-main" class="page-layout__main">
          <slot />
        </main>
        <aside class="page-layout__sidebar">
          <slot name="sidebar" />
        </aside>
      </div>
      <footer class="site-footer">
        <p>
          Compiled for research and design exploration. Built with Astro and tuned for instant-load
          storytelling.
        </p>
      </footer>
    </div>
    <script type="module" defer src={spotifyToggleScriptHref}></script>
    <script type="module" defer src={scrollControlsScriptHref}></script>
    <script type="module" defer src={navigationScriptHref}></script>
    <script type="module" defer src={serviceWorkerScriptHref}></script>
  </body>
</html>
