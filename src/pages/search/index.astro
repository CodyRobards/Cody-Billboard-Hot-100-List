---
import SiteLayout from "../../layouts/SiteLayout.astro";
import { loadNumberOneSearchIndex } from "../../lib/number-one-search-index";
import numberOneSearchScriptHref from "../../scripts/number-one-search.ts?url";

const results = await loadNumberOneSearchIndex();
const indexJson = JSON.stringify(results).replace(/</g, "\\u003c");
---

<SiteLayout
  pageTitle="Search #1 hits"
  description="Instantly filter Billboard Hot 100 number-one songs across the full archive."
>
  <section
    class="section"
    aria-labelledby="number-one-search-heading"
    data-number-one-search-index-json={indexJson}
  >
    <header class="section__header">
      <h1 class="section__title" id="number-one-search-heading">Search #1 hits</h1>
      <p class="section__lead">
        Type a song title, artist, or year to filter every Billboard Hot 100 number-one in the
        archive. Results update instantly and preserve the Spotify previews.
      </p>
    </header>

    <form
      class="number-one-search__form"
      role="search"
      aria-label="Search number-one hits"
      novalidate
      data-number-one-search-form
    >
      <label class="number-one-search__label" for="number-one-search-input">
        Search by song, artist, or year
      </label>
      <input
        id="number-one-search-input"
        class="number-one-search__input"
        type="search"
        name="q"
        inputmode="search"
        autocomplete="off"
        placeholder="Try Whitney Houston 1986"
        data-number-one-search-input
        aria-describedby="number-one-search-count"
      />
    </form>

    <p
      class="number-one-search__count"
      id="number-one-search-count"
      data-number-one-search-count
      aria-live="polite"
    >
      Loading #1 hitsâ€¦
    </p>
    <p class="number-one-search__empty" data-number-one-search-empty aria-live="polite" hidden>
      No #1 hits match your search. Try another song title, artist, or year.
    </p>

    <ol class="overall-ranking-list number-one-search-results" data-number-one-search-list></ol>

    <script type="module" defer src={numberOneSearchScriptHref}></script>
  </section>
</SiteLayout>

<style>
  .number-one-search__form {
    display: grid;
    gap: 0.5rem;
    margin-top: 1rem;
    max-width: 28rem;
  }

  .number-one-search__label {
    font-weight: 600;
  }

  .number-one-search__input {
    padding: 0.6rem 0.75rem;
    border: 1px solid var(--color-border, rgba(0, 0, 0, 0.12));
    border-radius: 0.75rem;
    font: inherit;
    color: inherit;
    background-color: var(--color-surface, #fff);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
  }

  .number-one-search__input:focus-visible {
    outline: 3px solid var(--color-accent, rgba(138, 43, 226, 0.4));
    outline-offset: 2px;
  }

  .number-one-search__count,
  .number-one-search__empty {
    margin-top: 0.75rem;
    color: var(--color-text-muted, rgba(0, 0, 0, 0.65));
  }

  .number-one-search__empty {
    font-style: italic;
  }
</style>
