---
import type { NumberOneSearchRecord } from "../lib/number-one-search-index";

interface Props {
  items: NumberOneSearchRecord[];
}

const { items } = Astro.props as Props;
---

<ol class="overall-ranking-list number-one-search-results" data-number-one-search-list>
  {
    items.map((entry) => {
      const embedId = `search-${entry.id}`;
      return (
        <li
          class="overall-ranking-list__item number-one-search-results__item"
          data-entry-id={entry.id}
        >
          <span class="overall-ranking-list__position number-one-search-results__year">
            {entry.year}
          </span>
          <div class="overall-ranking-list__content">
            <div class="overall-ranking-list__details">
              <span class="overall-ranking-list__title">{entry.title}</span>
              <span class="overall-ranking-list__artist">{entry.artist}</span>
              <div class="number-one-search-results__meta">
                <a class="number-one-search-results__year-link" href={`/years/${entry.slug}/`}>
                  View {entry.year} recap
                </a>
                <span
                  class="number-one-search-results__stat"
                  aria-label={`Year ranking: #${entry.yearRanking}`}
                >
                  #{entry.yearRanking} year ranking
                </span>
                <span class="number-one-search-results__stat">
                  #{entry.sequence + 1} number-one hit of {entry.year}
                </span>
              </div>
              {entry.notes.length ? (
                <ul class="number-one-search-results__notes">
                  {entry.notes.map((note) => (
                    <li>{note}</li>
                  ))}
                </ul>
              ) : null}
            </div>
            {entry.spotifyTrackId ? (
              <div class="overall-ranking-list__preview">
                <button
                  type="button"
                  class="overall-ranking-list__spotify-toggle"
                  data-track-id={entry.spotifyTrackId}
                  aria-controls={embedId}
                  aria-expanded="false"
                >
                  Play on Spotify
                </button>
                <div id={embedId} class="overall-ranking-list__spotify" hidden />
              </div>
            ) : null}
          </div>
        </li>
      );
    })
  }
</ol>

<style>
  .number-one-search-results {
    margin-top: 1.5rem;
  }

  .number-one-search-results__item {
    align-items: stretch;
  }

  .number-one-search-results__year {
    font-size: 1.2rem;
  }

  .number-one-search-results__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem 1rem;
    margin-top: 0.5rem;
    color: var(--color-text-muted, rgba(0, 0, 0, 0.65));
  }

  .number-one-search-results__year-link {
    font-weight: 600;
    color: inherit;
  }

  .number-one-search-results__year-link:focus-visible,
  .number-one-search-results__year-link:hover {
    color: var(--color-accent, #8a2be2);
  }

  .number-one-search-results__stat {
    white-space: nowrap;
  }

  .number-one-search-results__notes {
    margin: 0.75rem 0 0;
    padding-left: 1.25rem;
    display: grid;
    gap: 0.35rem;
  }

  .number-one-search-results__notes li {
    list-style: disc;
  }

  @media (max-width: 48rem) {
    .number-one-search-results__stat {
      white-space: normal;
    }
  }
</style>
